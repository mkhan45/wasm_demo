<html>
    <head>
        <title> Ack in WASM </title>
    </head>
    <body>
        <h1> Ack </h1>
        <input type="number" id="m" value="3">
        <input type="number" id="n" value="3">
        <div> Time: <span id="time">None</span> </div>
        <div> Result: <span id="result">None</span> </div>
        <button onclick="show_error()"> WASM Calculate </button>
        <button onclick="js_ack()"> JS Calculate </button>
    </body>
    <script>
        let wasm = WebAssembly.instantiateStreaming(fetch("ack.wasm"));
        wasm.then(module => {
            console.log(module);

            let wasm_ack = module.instance.exports.ack;
            let btn = document.querySelector("button");
            btn.onclick = () => {
                let m = document.getElementById("m").value;
                let n = document.getElementById("n").value;
                let result = document.getElementById("result");
                result.innerHTML = "Calculating...";

                let t1 = Date.now();
                let ans = wasm_ack(m, n);
                let t2 = Date.now();
                result.innerHTML = ans;

                let elapsed = t2 - t1;
                let time = document.getElementById("time");
                time.innerHTML = elapsed + " ms";
            };
        });

        function show_error() {
            let result = document.getElementById("result");
            result.innerHTML = "WASM has not been loaded yet";
        }

        function ack(m, n) {
            if (m == 0) {
                return n + 1;
            } else if (n == 0) {
                return ack(m - 1, 1);
            } else {
                return ack(m - 1, ack(m, n - 1));
            }
        }

        function js_ack() {
            let m = document.getElementById("m").value;
            let n = document.getElementById("n").value;
            let result = document.getElementById("result");
            result.innerHTML = "Calculating...";

            let t1 = Date.now();
            let ans = ack(m, n);
            let t2 = Date.now();
            result.innerHTML = ans;

            let elapsed = t2 - t1;
            let time = document.getElementById("time");
            time.innerHTML = elapsed + " ms";
        }
    </script>
</html>
